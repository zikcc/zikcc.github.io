<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>每日知识点-5 | 塑料星空</title><meta name="keywords" content="Linux,C++,C"><meta name="author" content="zikcc"><meta name="copyright" content="zikcc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="每日知识点-5"><meta name="application-name" content="每日知识点-5"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="每日知识点-5"><meta property="og:url" content="https://zikcc.github.io/2025/05/27/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-5/index.html"><meta property="og:site_name" content="塑料星空"><meta property="og:description" content="每日知识点-5   1. SFINAE (Substitution Failure Is Not An Error) (替换失败不是错误) 的原理及在类型萃取中的应用  原理: 模板实例化时, 若替换导致无效类型&amp;#x2F;表达式, 该模板被静默忽略, 继续寻找其他可行模板, 它允许在模板实例化过程中, 如"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg"><meta property="article:author" content="zikcc"><meta property="article:tag" content="编程笔记 代码片段 开发环境 技术博客 解决方案"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg"><meta name="description" content="每日知识点-5   1. SFINAE (Substitution Failure Is Not An Error) (替换失败不是错误) 的原理及在类型萃取中的应用  原理: 模板实例化时, 若替换导致无效类型&amp;#x2F;表达式, 该模板被静默忽略, 继续寻找其他可行模板, 它允许在模板实例化过程中, 如"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://zikcc.github.io/2025/05/27/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-5/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?77d87efef35b6b7a18fe3874796b663d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"断开TCP连接...","backTitle":"SYN/ACK! 重新握手成功"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"🌙 夜色温柔，愿星光为你守候","list":[{"greeting":"🌌 星河入梦时，愿你好眠如婴","startTime":0,"endTime":5},{"greeting":"🌄 晨光吻醒窗棂，新的一天正为你绽放笑颜","startTime":6,"endTime":8},{"greeting":"☀️ 朝露未晞时，愿你心如晴空般明朗","startTime":9,"endTime":10},{"greeting":"🍚 正午的阳光为午餐撒上金黄的佐料","startTime":11,"endTime":12},{"greeting":"🌿 饭后的慵懒时光，连时钟都走得慢了些","startTime":12,"endTime":13},{"greeting":"🕊 午后三时的风，正轻轻翻阅你未完成的故事","startTime":13,"endTime":14},{"greeting":"🌻 光阴的画笔正为你描绘今日的精彩","startTime":14,"endTime":17},{"greeting":"🍽 暮色中的炊烟，是生活给你的温柔奖赏","startTime":17,"endTime":19},{"greeting":"🕯 华灯初上时，这是专属于你的宁静时光","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://zikcc-twikoo.netlify.app/.netlify/functions/twikoo',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":["🌍 sudo 重启地球 --force","🚀 星际 PR 被拒, 缺少地球人 review","💥 Git push --force 到火星","🌠 在虫洞里 debug 多线程","🗜️ 用 FFmpeg 压缩宇宙背景辐射","🤖 用 Python 爬取外星 WIFI 密码","🔍 uboot 荒野求生指南","🌌 用 Docker 打包月球"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: zikcc","link":"链接: ","source":"来源: 塑料星空","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '塑料星空',
  title: '每日知识点-5',
  postAI: '',
  pageFillDescription: ' 每日知识点-5,  1. SFINAE (Substitution Failure Is Not An Error) (替换失败不是错误) 的原理及在类型萃取中的应用,  2. CRTP (Curiously Recurring Template Pattern) (奇异递归模板模式) 的静态多态实现,  3. 完美转发 (Perfect Forwarding) 的实现与 stdforward 的作用,  4. 模板元编程在嵌入式性能优化中的局限性,  5. 自旋锁 (spinlock) 与互斥锁 (mutex) 的使用场景对比,  6. RCU (Read-Copy-Update) 的原理及适用场景,  7. 内存屏障 (Memory Barrier) 在 ARM 多核架构中的作用,  8. 模型量化的基本原理及对推理速度/精度的影响,  9. 嵌入式部署中模型权重的内存对齐优化方法,  10. 解释 TensorRT 中的层融合 (Layer Fusion) 优化原理,  综合应用题每日知识点替换失败不是错误的原理及在类型萃取中的应用原理模板实例化时若替换导致无效类型表达式该模板被静默忽略继续寻找其他可行模板它允许在模板实例化过程中如果某个模板参数的替换导致编译错误编译器不会报错而是简单地忽略这个模板实例化应用如果输入的具有这个成员函数那么不会产生错误就会继承这个类里面只有一个静态成员如果没有这个成员函数就会出错那么就会跳过下面的这个模板去调用上面的模板也就是直接继承为什么认为是成员函数而不是成员变量用于获取类型中的成员的地址如果是成员函数会得到一个指向成员函数的指针例如等会得到一个指向成员变量的指针例如能够将表达式的结果类型折叠为但是没有的变量类型获取成员变量一般使用项目关联在模型序列化框架中用检测自定义层是否实现方法实现泛型处理类似的序列化机制奇异递归模板模式的静态多态实现引言即奇异递归模板模式是中一个独特而强大的设计模式它利用模板和继承的特性允许在编译时进行多态操作从而提高代码的性能和灵活性在人类思维中我们经常倾向于通过继承和类似性来理解和分类事物以一种类似的方式工作通过继承自己在子类中使用父类模板它在技术上实现了一种自我认知的模式实现派生类将自身作为模板参数传递给基类优势零虚函数开销适合于嵌入式高频调用的算法基类例如调用具体子类的输出无虚函数开销对比项虚函数多态时机编译期运行期性能无虚表查找开销有虚函数调用开销是否可静态调用支持如不支持代码生成模板实例化可能代码膨胀单份虚表适用场景高性能库编译期检查运行时动态多态完美转发的实现与的作用前言万能引用万能引用是完美转发的基础其形式为其中是模板参数是万能引用万能引用的关键特性可以绑定到左值或右值通过引用折叠规则确定最终类型引用折叠规则当模板参数推导遇到引用的引用时使用以下规则进行折叠原理通过右值引用和引用折叠保留参数原始类型保留的左值右值性在转发时恢复参数的原始类型左值引用右值引用调用调用条件转换为右值引用当为非左值引用类型时模板元编程在嵌入式性能优化中的局限性局限性编译时间膨胀模板实例化过多调试困难错误信息冗长代码体积增大可能影响存储优化策略限制递归深度如替代部分模板模板元编程时期编译期执行机制通过模板特化递归实例化在编译期生成代码典型应用类型计算编译期数值计算缺点语法晦涩编译错误信息难懂编译速度慢例如用模板计算阶乘编译期计算函数时期编译期或运行期执行取决于调用上下文机制用普通函数语法实现编译期计算典型应用替代简单的模板数值计算优点代码直观编译错误友好编译期计算使用约束模板参数自旋锁与互斥锁的使用场景对比前言锁类型比喻场景行为自旋锁你在便利店抢最后一瓶水不断问店员有了吗有了吗循环检查忙等待占着一直检查锁是否释放互斥锁你在便利店抢最后一瓶水店员说没货了你去旁边沙发睡觉到货后店员叫醒你睡眠等待让出锁可用时被系统唤醒特性自旋锁互斥锁等待方式循环检查消耗线程挂起不消耗开销高频占用上下文切换开销适用场景锁持有时间极短纳秒微秒级锁持有时间较长毫秒级以上实现级别通常需原子指令如依赖操作系统如线程状态始终处于运行状态可能被阻塞自旋锁场景临界区极短无阻塞中断上下文多核环境实现忙等待互斥锁场景临界区较长可能阻塞如文件用户态线程实现睡眠等待项目关联在多核设备驱动中中断处理函数用自旋锁保护共享寄存器为什么在中断处理中用自旋锁中断上下文不能睡眠中断处理函数如的不能调用可能引发睡眠的函数如互斥锁而自旋锁是唯一选择多核竞争多核可能同时访问同一硬件寄存器需保证原子性短临界区寄存器操作通常极快纳秒级适合自旋锁的忙等待特性的原理及适用场景前言是内核中一种重要的同步机制它针对读多写少的场景提供了极高的读取性能的基本理念可以用三句话概括读取无锁读者不需要任何锁或原子操作可以极速访问数据写者同步写者通过复制更新替换的方式修改数据延迟回收确保没有读者后再释放旧数据这种设计使得在读取频率远高于写入频率的场景下性能远超传统的读写锁原理读侧无锁访问数据仅需内存屏障写侧创建副本修改后原子替换指针异步回收旧数据适用场景读多写少的数据结构如路由表内核链表优势读操作零阻塞写操作延迟回收避免竞争内存屏障在多核架构中的作用问题多核乱序执行和缓存不一致可能导致数据同步错误解决方案写屏障确保屏障前的写操作先于屏障后的写操作完成读屏障确保屏障前的读操作先于屏障后的读操作完成项目关联在异构计算中同步模型权重数据时需显式插入内存屏障模型量化的基本原理及对推理速度精度的影响原理将权重激活值映射到动态范围缩放影响速度减少内存带宽加速指令如的精度可能损失边缘样本的识别能力需校准数据集补偿项目关联中采用混合量化策略敏感层保持嵌入式部署中模型权重的内存对齐优化方法优化方法权重数组按字节对齐适配使用分配内存结构体用修饰效果减少提升传输效率如瑞芯微解释中的层融合优化原理原理将连续层如合并为单一内核减少内存读写次数中间结果复用内核启动开销上下文切换项目关联在部署时自动融合中的层推理速度提升倍综合应用题设计一个支持动态优先级调整的线程池阻塞在这里只有或者队列不为空才结束的作用将从左值转为右值允许移动而非拷贝如果的类型支持移动语义如等则会调用移动构造函数避免不必要的深拷贝提高性能',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-09 17:20:39',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/poem.css"><link rel="stylesheet" href="/custom/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://zikcc.oss-cn-beijing.aliyuncs.com/img/20250324140542.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">塑料星空</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 更多</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><span> 统计</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 1.05rem;">C<sup>38</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>40</sup></a><a href="/tags/Camke/" style="font-size: 1.05rem;">Camke<sup>1</sup></a><a href="/tags/Chaquopy/" style="font-size: 1.05rem;">Chaquopy<sup>1</sup></a><a href="/tags/Clangd/" style="font-size: 1.05rem;">Clangd<sup>1</sup></a><a href="/tags/Cuda/" style="font-size: 1.05rem;">Cuda<sup>2</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>5</sup></a><a href="/tags/FFmpeg/" style="font-size: 1.05rem;">FFmpeg<sup>2</sup></a><a href="/tags/GDB/" style="font-size: 1.05rem;">GDB<sup>1</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>1</sup></a><a href="/tags/HLS/" style="font-size: 1.05rem;">HLS<sup>2</sup></a><a href="/tags/HTTP-FLV/" style="font-size: 1.05rem;">HTTP-FLV<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>3</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>44</sup></a><a href="/tags/Mysql/" style="font-size: 1.05rem;">Mysql<sup>1</sup></a><a href="/tags/Nginx/" style="font-size: 1.05rem;">Nginx<sup>2</sup></a><a href="/tags/Nuxt3/" style="font-size: 1.05rem;">Nuxt3<sup>1</sup></a><a href="/tags/OpenCV/" style="font-size: 1.05rem;">OpenCV<sup>3</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>3</sup></a><a href="/tags/Pytorch/" style="font-size: 1.05rem;">Pytorch<sup>2</sup></a><a href="/tags/RTMP/" style="font-size: 1.05rem;">RTMP<sup>2</sup></a><a href="/tags/SpringBoot/" style="font-size: 1.05rem;">SpringBoot<sup>1</sup></a><a href="/tags/TFlite/" style="font-size: 1.05rem;">TFlite<sup>1</sup></a><a href="/tags/Visual-Studio/" style="font-size: 1.05rem;">Visual Studio<sup>1</sup></a><a href="/tags/Vscode/" style="font-size: 1.05rem;">Vscode<sup>2</sup></a><a href="/tags/Vue/" style="font-size: 1.05rem;">Vue<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">22</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">27</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url">面试</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a><a class="article-meta__tags" href="/tags/C/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>C++</span></a><a class="article-meta__tags" href="/tags/C/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>C</span></a></span></div></div><h1 class="post-title" itemprop="name headline">每日知识点-5</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-05-27T01:31:43.000Z" title="发表于 2025-05-27 09:31:43">2025-05-27</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-07-09T09:20:39.817Z" title="更新于 2025-07-09 17:20:39">2025-07-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">2.7k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>9分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="每日知识点-5"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为无锡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>无锡</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/05/27/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-5/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://zikcc.github.io/2025/05/27/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-5/"><header><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url">面试</a><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><a href="/tags/C/" tabindex="-1" itemprop="url">C++</a><a href="/tags/C/" tabindex="-1" itemprop="url">C</a><h1 id="CrawlerTitle" itemprop="name headline">每日知识点-5</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">zikcc</span><time itemprop="dateCreated datePublished" datetime="2025-05-27T01:31:43.000Z" title="发表于 2025-05-27 09:31:43">2025-05-27</time><time itemprop="dateCreated datePublished" datetime="2025-07-09T09:20:39.817Z" title="更新于 2025-07-09 17:20:39">2025-07-09</time></header><h2 id="每日知识点-5"><a class="markdownIt-Anchor" href="#每日知识点-5"></a> 每日知识点-5</h2>
<hr />
<h3 id="1-sfinae-substitution-failure-is-not-an-error-替换失败不是错误-的原理及在类型萃取中的应用"><a class="markdownIt-Anchor" href="#1-sfinae-substitution-failure-is-not-an-error-替换失败不是错误-的原理及在类型萃取中的应用"></a> <strong>1. SFINAE (Substitution Failure Is Not An Error) (替换失败不是错误) 的原理及在类型萃取中的应用</strong></h3>
<ul>
<li>原理: 模板实例化时, 若替换导致无效类型/表达式, 该模板被静默忽略, 继续寻找其他可行模板, 它允许在模板实例化过程中, 如果某个模板参数的替换导致编译错误, 编译器不会报错, 而是简单地忽略这个模板实例化。。</li>
<li>应用:  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 如果输入的 T 具有 serialize 这个成员函数, 那么不会产生错误, has_serialize 就会继承 true_type 这个类, 里面只有一个静态成员 true</span>
<span class="token comment">// 如果没有这个成员函数, 就会出错, 那么就会跳过下面的这个模板, 去调用上面的模板, 也就是直接继承 false_type</span>
<span class="token comment">// 为什么认为 serialize 是成员函数而不是成员变量? </span>
<span class="token comment">// &amp;T::serialize 用于获取T类型中的serialize成员的地址</span>
<span class="token comment">// 如果 serialize 是成员函数, decltype(&amp;T::serialize) 会得到一个指向成员函数的指针 例如, void (T::*)(), int (T::*) (int)等</span>
<span class="token comment">// &amp;T::serialize会得到一个指向成员变量的指针 例如, int T::*</span>
<span class="token comment">// void_t 能够将 表达式的结果类型折叠为 void, 但是没有 void 的变量类型。</span>
<span class="token comment">// 获取成员变量一般使用 T::member</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token operator">=</span> <span class="token keyword">void</span><span class="token operator">></span> 
<span class="token keyword">struct</span> <span class="token class-name">has_serialize</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">false_type</span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">has_serialize</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> void_t<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>T<span class="token double-colon punctuation">::</span>serialize<span class="token punctuation">)</span><span class="token operator">>></span> <span class="token operator">:</span> true_type <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>项目关联: 在模型序列化框架中, 用 SFINAE 检测自定义层是否实现 serialize() 方法, 实现泛型处理(类似 ONNX 的序列化机制)</li>
</ul>
<h3 id="2-crtp-curiously-recurring-template-pattern-奇异递归模板模式-的静态多态实现"><a class="markdownIt-Anchor" href="#2-crtp-curiously-recurring-template-pattern-奇异递归模板模式-的静态多态实现"></a> <strong>2. CRTP (Curiously Recurring Template Pattern) (奇异递归模板模式) 的静态多态实现</strong></h3>
<ul>
<li>引言: CRTP, 即奇异递归模板模式(Curiously Recurring Template Pattern), 是C++中一个独特而强大的设计模式。它利用模板和继承的特性, 允许在编译时进行多态操作, 从而提高代码的性能和灵活性。在人类思维中, 我们经常倾向于通过继承和类似性来理解和分类事物。CRTP以一种类似的方式工作, 通过继承自己(在子类中使用父类模板), 它在技术上实现了一种“自我认知”的模式。</li>
<li>实现: 派生类将自身作为模板参数传递给基类  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Derived</span><span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">void</span> <span class="token function">interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Derived<span class="token operator">*</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Base</span><span class="token operator">&lt;</span><span class="token class-name">Derived</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">void</span> <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">/* ... */</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>优势: 零虚函数开销, 适合于嵌入式高频调用的算法基类
<ul>
<li>例如:  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Derived</span><span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Derived<span class="token operator">*</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">draw_impl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用具体子类的 draw_impl()</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Shape</span><span class="token operator">&lt;</span><span class="token class-name">Circle</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">draw_impl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Drawing a circle\n"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Square</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Shape</span><span class="token operator">&lt;</span><span class="token class-name">Square</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">draw_impl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Drawing a square\n"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    Circle c<span class="token punctuation">;</span>
    c<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出 "Drawing a circle"（无虚函数开销！）</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>对比项</strong></th>
<th style="text-align:left"><strong>CRTP</strong></th>
<th style="text-align:left"><strong>虚函数</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>多态时机</strong></td>
<td style="text-align:left">编译期</td>
<td style="text-align:left">运行期</td>
</tr>
<tr>
<td style="text-align:left"><strong>性能</strong></td>
<td style="text-align:left">无虚表查找开销</td>
<td style="text-align:left">有虚函数调用开销</td>
</tr>
<tr>
<td style="text-align:left"><strong>是否可静态调用</strong></td>
<td style="text-align:left">支持（如 <code>static_func</code>）</td>
<td style="text-align:left">不支持</td>
</tr>
<tr>
<td style="text-align:left"><strong>代码生成</strong></td>
<td style="text-align:left">模板实例化（可能代码膨胀）</td>
<td style="text-align:left">单份虚表</td>
</tr>
<tr>
<td style="text-align:left"><strong>适用场景</strong></td>
<td style="text-align:left">高性能库、编译期检查</td>
<td style="text-align:left">运行时动态多态</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="3-完美转发-perfect-forwarding-的实现与-stdforward-的作用"><a class="markdownIt-Anchor" href="#3-完美转发-perfect-forwarding-的实现与-stdforward-的作用"></a> <strong>3. 完美转发 (Perfect Forwarding) 的实现与 std::forward 的作用</strong></h3>
<ul>
<li>前言:
<ul>
<li>万能引用（Universal Reference）<br />
万能引用是完美转发的基础, 其形式为 T&amp;&amp;, 其中 T 是模板参数：  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// arg 是万能引用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
万能引用的关键特性：
<ul>
<li>可以绑定到左值或右值</li>
<li>通过引用折叠规则（Reference Collapsing）确定最终类型<br />
引用折叠规则:<br />
当模板参数推导遇到引用的引用时, C++使用以下规则进行折叠：  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">T<span class="token operator">&amp;</span> <span class="token operator">&amp;</span> → T<span class="token operator">&amp;</span>
T<span class="token operator">&amp;</span> <span class="token operator">&amp;&amp;</span> → T<span class="token operator">&amp;</span>
T<span class="token operator">&amp;&amp;</span> <span class="token operator">&amp;</span> → T<span class="token operator">&amp;</span>
T<span class="token operator">&amp;&amp;</span> <span class="token operator">&amp;&amp;</span> → T<span class="token operator">&amp;&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li>原理: 通过右值引用和引用折叠保留参数原始类型  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">warpper</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">target</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 保留arg的左值/右值性。在转发时恢复参数的原始类型</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">target</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">&amp;</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"左值引用\n"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">target</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">&amp;&amp;</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"右值引用\n"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token function">wrapper</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 调用 target(int&amp;)</span>
    <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 调用 target(int&amp;&amp;)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>std::forward: 条件转换为右值引用 (当 T 为非左值引用类型时)</li>
</ul>
<h3 id="4-模板元编程在嵌入式性能优化中的局限性"><a class="markdownIt-Anchor" href="#4-模板元编程在嵌入式性能优化中的局限性"></a> <strong>4. 模板元编程在嵌入式性能优化中的局限性</strong></h3>
<ul>
<li>局限性：
<ul>
<li>编译时间膨胀(模板实例化过多)</li>
<li>调试困难(错误信息冗长)</li>
<li>代码体积增大(可能影响 Flash 存储)</li>
</ul>
</li>
<li>优化策略：
<ul>
<li>限制递归深度 (如 constexpr 替代部分模板)<br />
(1) 模板元编程（TMP）<br />
时期：编译期执行<br />
机制：通过模板特化、递归实例化在编译期生成代码<br />
典型应用：类型计算、编译期数值计算<br />
缺点：语法晦涩、编译错误信息难懂、编译速度慢<br />
例如：  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 用模板计算阶乘</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> N<span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">Factorial</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int</span> value <span class="token operator">=</span> N <span class="token operator">*</span> Factorial<span class="token operator">&lt;</span>N<span class="token operator">-</span><span class="token number">1</span><span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">Factorial</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> x <span class="token operator">=</span> Factorial<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">;</span> <span class="token comment">// 编译期计算120</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
(2) constexpr 函数<br />
时期：编译期或运行期执行（取决于调用上下文）<br />
机制：用普通函数语法实现编译期计算<br />
典型应用：替代简单的模板数值计算<br />
优点：代码直观、编译错误友好  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">constexpr</span> <span class="token keyword">int</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 编译期计算120</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>使用 concepts (C++20) 约束模板参数</li>
</ul>
</li>
</ul>
<h3 id="5-自旋锁-spinlock-与互斥锁-mutex-的使用场景对比"><a class="markdownIt-Anchor" href="#5-自旋锁-spinlock-与互斥锁-mutex-的使用场景对比"></a> <strong>5. 自旋锁 (spinlock) 与互斥锁 (mutex) 的使用场景对比</strong></h3>
<ul>
<li>
<p>前言：</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>锁类型</strong></th>
<th style="text-align:left"><strong>比喻场景</strong></th>
<th style="text-align:left"><strong>行为</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>自旋锁</strong></td>
<td style="text-align:left">你在便利店抢最后一瓶水，不断问店员：“有了吗？有了吗？”（循环检查）</td>
<td style="text-align:left"><strong>忙等待（Busy-wait）</strong>：占着CPU一直检查锁是否释放</td>
</tr>
<tr>
<td style="text-align:left"><strong>互斥锁</strong></td>
<td style="text-align:left">你在便利店抢最后一瓶水，店员说&quot;没货了&quot;，你去旁边沙发睡觉，到货后店员叫醒你</td>
<td style="text-align:left"><strong>睡眠等待（Sleep-wait）</strong>：让出CPU，锁可用时被系统唤醒</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>特性</strong></th>
<th style="text-align:left"><strong>自旋锁（Spinlock）</strong></th>
<th style="text-align:left"><strong>互斥锁（Mutex）</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>等待方式</strong></td>
<td style="text-align:left">循环检查（消耗CPU）</td>
<td style="text-align:left">线程挂起（不消耗CPU）</td>
</tr>
<tr>
<td style="text-align:left"><strong>开销</strong></td>
<td style="text-align:left">高频CPU占用</td>
<td style="text-align:left">上下文切换开销</td>
</tr>
<tr>
<td style="text-align:left"><strong>适用场景</strong></td>
<td style="text-align:left">锁持有时间极短（纳秒/微秒级）</td>
<td style="text-align:left">锁持有时间较长（毫秒级以上）</td>
</tr>
<tr>
<td style="text-align:left"><strong>实现级别</strong></td>
<td style="text-align:left">通常需原子指令（如CAS）</td>
<td style="text-align:left">依赖操作系统API（如futex）</td>
</tr>
<tr>
<td style="text-align:left"><strong>线程状态</strong></td>
<td style="text-align:left">始终处于运行状态（Runnable）</td>
<td style="text-align:left">可能被阻塞（Blocked）</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>自旋锁：</p>
<ul>
<li>场景：临界区极短(无阻塞)、中断上下文、多核环境</li>
<li>实现：忙等待 (spin_lock_irqsave())</li>
</ul>
</li>
<li>
<p>互斥锁：</p>
<ul>
<li>场景：临界区较长、可能阻塞 (如文件 IO)、用户态线程</li>
<li>实现：睡眠等待 (mutex_lock())</li>
</ul>
</li>
<li>
<p>项目关联：在多核 ARM 设备驱动中, 中断处理函数用自旋锁保护共享寄存器<br />
为什么在中断处理中用自旋锁？<br />
中断上下文不能睡眠：中断处理函数（如Linux的irq_handler）不能调用可能引发睡眠的函数（如互斥锁mutex_lock）, 而自旋锁是唯一选择。<br />
多核竞争：多核CPU可能同时访问同一硬件寄存器, 需保证原子性。<br />
短临界区：寄存器操作通常极快（纳秒级）, 适合自旋锁的忙等待特性。</p>
</li>
</ul>
<h3 id="6-rcu-read-copy-update-的原理及适用场景"><a class="markdownIt-Anchor" href="#6-rcu-read-copy-update-的原理及适用场景"></a> <strong>6. RCU (Read-Copy-Update) 的原理及适用场景</strong></h3>
<ul>
<li>前言：<br />
RCU（Read-Copy-Update）是Linux内核中一种重要的同步机制, 它针对&quot;读多写少&quot;的场景提供了极高的读取性能。<br />
RCU的基本理念可以用三句话概括：<br />
读取无锁：读者不需要任何锁或原子操作, 可以极速访问数据<br />
写者同步：写者通过复制-更新-替换的方式修改数据<br />
延迟回收：确保没有读者后再释放旧数据<br />
这种设计使得在读取频率远高于写入频率的场景下, 性能远超传统的读写锁。</li>
<li>原理:
<ol>
<li>读侧：无锁访问数据 (仅需内存屏障)</li>
<li>写侧：创建副本修改后, 原子替换指针, 异步回收旧数据</li>
</ol>
</li>
<li>适用场景：<br />
读多写少的数据结构 (如路由表、内核链表)</li>
<li>优势：<br />
读操作零阻塞, 写操作延迟回收避免竞争。</li>
</ul>
<h3 id="7-内存屏障-memory-barrier-在-arm-多核架构中的作用"><a class="markdownIt-Anchor" href="#7-内存屏障-memory-barrier-在-arm-多核架构中的作用"></a> <strong>7. 内存屏障 (Memory Barrier) 在 ARM 多核架构中的作用</strong></h3>
<ul>
<li>问题：多核乱序执行和缓存不一致可能导致数据同步错误</li>
<li>解决方案：
<ul>
<li>写屏障 (dmb st) : 确保屏障前的写操作先于屏障后的写操作完成。</li>
<li>读屏障 (dmb ld) : 确保屏障前的读操作先于屏障后的读操作完成。</li>
</ul>
</li>
<li>项目关联：<br />
在异构计算 (CPU + NPU) 中同步模型权重数据时需显式插入内存屏障</li>
</ul>
<h3 id="8-模型量化的基本原理及对推理速度精度的影响"><a class="markdownIt-Anchor" href="#8-模型量化的基本原理及对推理速度精度的影响"></a> <strong>8. 模型量化的基本原理及对推理速度/精度的影响</strong></h3>
<ul>
<li>原理：将 FP32 权重/激活值映射到 INT8 (动态范围缩放)</li>
<li>影响：
<ul>
<li>速度：减少内存带宽, 加速 SIMD 指令 (如 ARM NEON 的vqmovn)</li>
<li>精度：可能损失边缘样本的识别能力 (需校准数据集补偿)</li>
</ul>
</li>
<li>项目关联: TensorRT 中采用混合量化策略 (敏感层保持 FP16)</li>
</ul>
<h3 id="9-嵌入式部署中模型权重的内存对齐优化方法"><a class="markdownIt-Anchor" href="#9-嵌入式部署中模型权重的内存对齐优化方法"></a> <strong>9. 嵌入式部署中模型权重的内存对齐优化方法</strong></h3>
<ul>
<li>优化方法：
<ul>
<li>权重数组按 64 字节对齐 (适配 Cache Line)</li>
<li>使用 posix_memalign 分配内存</li>
<li>结构体用 <strong>attribute</strong>((aligned))修饰</li>
</ul>
</li>
<li>效果:<br />
减少 Cache Miss, 提升 NPU DMA 传输效率 (如瑞芯微 RKNN SDK)</li>
</ul>
<h3 id="10-解释-tensorrt-中的层融合-layer-fusion-优化原理"><a class="markdownIt-Anchor" href="#10-解释-tensorrt-中的层融合-layer-fusion-优化原理"></a> <strong>10. 解释 TensorRT 中的层融合 (Layer Fusion) 优化原理</strong></h3>
<ul>
<li>原理：将连续层(如 Conv + ReLU + BN) 合并为单一内核, 减少:
<ul>
<li>内存读写次数 (中间结果复用)</li>
<li>内核启动开销 (CUDA 上下文切换)</li>
</ul>
</li>
<li>项目关联：在 Jetson Nano 部署 YOLOv5 时, TensorRT 自动融合 Backbone 中的 Conv+Silu 层, 推理速度提升3倍。</li>
</ul>
<hr />
<h3 id="综合应用题"><a class="markdownIt-Anchor" href="#综合应用题"></a> <strong>综合应用题</strong></h3>
<p>设计一个支持动态优先级调整的线程池</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">ThreadPool</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">using</span> Task <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">;</span>

        <span class="token function">ThreadPool</span><span class="token punctuation">(</span>size_t threads<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threads<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                workers<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">></span> <span class="token function">lock</span><span class="token punctuation">(</span>queue_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 阻塞在这里，只有 stop 或者 队列不为空才结束 wait</span>
                        condition<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>lock<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">return</span> stop <span class="token operator">||</span> <span class="token operator">!</span>tasks<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>stop <span class="token operator">&amp;&amp;</span> tasks<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                        <span class="token comment">// std::move 的作用</span>
                        <span class="token comment">// 将tasks.top().second从左值转为右值（允许移动而非拷贝）</span>
                        <span class="token comment">// 如果second的类型支持移动语义（如std::function、std::string等），则会调用移动构造函数</span>
                        <span class="token comment">// 避免不必要的深拷贝，提高性能</span>
                        <span class="token keyword">auto</span> task <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>tasks<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        tasks<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token operator">~</span><span class="token function">ThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#123;</span>
                std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">></span> <span class="token function">lock</span><span class="token punctuation">(</span>queue_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                stop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            condition<span class="token punctuation">.</span><span class="token function">notify_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> worker <span class="token operator">:</span> workers<span class="token punctuation">)</span> worker<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">void</span> <span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> priority<span class="token punctuation">,</span> Task task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#123;</span>
                std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">></span> <span class="token function">lock</span><span class="token punctuation">(</span>queue_mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                tasks<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>priority<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            condition<span class="token punctuation">.</span><span class="token function">notify_one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span><span class="token operator">:</span>
        std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>thread<span class="token operator">></span> workers<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>priority_queue<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> Task<span class="token operator">>></span> tasks<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>mutex queue_mutex<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>condition_variable condition<span class="token punctuation">;</span>
        <span class="token keyword">bool</span> stop<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>   
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="https://zikcc.oss-cn-beijing.aliyuncs.com/img/20250324140542.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="https://zikcc.oss-cn-beijing.aliyuncs.com/img/20250324140542.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">zikcc</div><div class="post-copyright__author_desc">Code · Debug · Repeat</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://zikcc.github.io/2025/05/27/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-5/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://zikcc.github.io/2025/05/27/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-5/')">每日知识点-5</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://zikcc.github.io/2025/05/27/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-5/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=每日知识点-5&amp;url=https://zikcc.github.io/2025/05/27/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-5/&amp;pic=https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zikcc.github.io" target="_blank">塑料星空</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">44</span></a><a class="post-meta__box__tags" href="/tags/C/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>C++<span class="tagsPageCount">40</span></a><a class="post-meta__box__tags" href="/tags/C/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>C<span class="tagsPageCount">38</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/001342-17369576223624.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/05/26/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE%E6%A0%88%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91%E5%AF%BC%E8%88%AA/"><img class="prev-cover" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/185306-17401351860382.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">自定义协议栈服务器开发导航</div></div></a></div><div class="next-post pull-right"><a href="/2025/05/28/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-6/"><img class="next-cover" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">每日知识点-6</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/05/26/%E6%AF%8F%E6%97%A5Linux-Cpp%E5%AF%BC%E8%88%AA/" title="每日知识点导航" style="height:100%;"><img class="cover" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-26</div><div class="title">每日知识点导航</div></div></a></div><div><a href="/2025/06/06/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-10/" title="每日知识点-10" style="height:100%;"><img class="cover" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-06</div><div class="title">每日知识点-10</div></div></a></div><div><a href="/2025/06/10/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-11/" title="每日知识点-11" style="height:100%;"><img class="cover" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-10</div><div class="title">每日知识点-11</div></div></a></div><div><a href="/2025/05/21/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-1/" title="每日知识点-1" style="height:100%;"><img class="cover" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-21</div><div class="title">每日知识点-1</div></div></a></div><div><a href="/2025/06/11/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-12/" title="每日知识点-12" style="height:100%;"><img class="cover" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-11</div><div class="title">每日知识点-12</div></div></a></div><div><a href="/2025/06/12/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-13/" title="每日知识点-13" style="height:100%;"><img class="cover" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-12</div><div class="title">每日知识点-13</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="https://zikcc.oss-cn-beijing.aliyuncs.com/img/20250324140542.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38; margin:0.6rem 0; text-align:justify; color:rgba(255, 255, 255, 0.8);"> <b style="color:#fff">这里记录代码片段、环境配置和报错解决, 偶尔分享开发技巧与踩坑日志。</b> </div> <div style="line-height:1.38; margin:0.6rem 0; text-align:justify; color:rgba(255, 255, 255, 0.8);"> <b style="color:#fff">希望这些实战经验能缩短你的调试时间, 让编程少些 Segment Fault, 多些 Hello World。</b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">zikcc</h1><div class="author-info__desc">Code · Debug · Repeat</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/zikcc" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget" id="card-poem"><div id="poem_sentence"></div><div id="poem_info"><div id="poem_dynasty"></div><div id="poem_author"></div></div></div><script src="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/jinrishici.js" charset="utf-8"></script><script type="text/javascript">jinrishici.load(function(result) {
var sentence = document.querySelector("#poem_sentence")
var author = document.querySelector("#poem_author")
var dynasty = document.querySelector("#poem_dynasty")

var sentenceText = result.data.content
sentenceText = sentenceText.substr(0, sentenceText.length - 1);
sentence.innerHTML = sentenceText
dynasty.innerHTML = result.data.origin.dynasty
author.innerHTML = result.data.origin.author + '《' + result.data.origin.title + '》'
});</script><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-5"><span class="toc-text"> 每日知识点-5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-sfinae-substitution-failure-is-not-an-error-%E6%9B%BF%E6%8D%A2%E5%A4%B1%E8%B4%A5%E4%B8%8D%E6%98%AF%E9%94%99%E8%AF%AF-%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9C%A8%E7%B1%BB%E5%9E%8B%E8%90%83%E5%8F%96%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text"> 1. SFINAE (Substitution Failure Is Not An Error) (替换失败不是错误) 的原理及在类型萃取中的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-crtp-curiously-recurring-template-pattern-%E5%A5%87%E5%BC%82%E9%80%92%E5%BD%92%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F-%E7%9A%84%E9%9D%99%E6%80%81%E5%A4%9A%E6%80%81%E5%AE%9E%E7%8E%B0"><span class="toc-text"> 2. CRTP (Curiously Recurring Template Pattern) (奇异递归模板模式) 的静态多态实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91-perfect-forwarding-%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E-stdforward-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text"> 3. 完美转发 (Perfect Forwarding) 的实现与 std::forward 的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%A8%A1%E6%9D%BF%E5%85%83%E7%BC%96%E7%A8%8B%E5%9C%A8%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%AD%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-text"> 4. 模板元编程在嵌入式性能优化中的局限性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%87%AA%E6%97%8B%E9%94%81-spinlock-%E4%B8%8E%E4%BA%92%E6%96%A5%E9%94%81-mutex-%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%AF%B9%E6%AF%94"><span class="toc-text"> 5. 自旋锁 (spinlock) 与互斥锁 (mutex) 的使用场景对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-rcu-read-copy-update-%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text"> 6. RCU (Read-Copy-Update) 的原理及适用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C-memory-barrier-%E5%9C%A8-arm-%E5%A4%9A%E6%A0%B8%E6%9E%B6%E6%9E%84%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text"> 7. 内存屏障 (Memory Barrier) 在 ARM 多核架构中的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%A8%A1%E5%9E%8B%E9%87%8F%E5%8C%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E5%8F%8A%E5%AF%B9%E6%8E%A8%E7%90%86%E9%80%9F%E5%BA%A6%E7%B2%BE%E5%BA%A6%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-text"> 8. 模型量化的基本原理及对推理速度&#x2F;精度的影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%83%A8%E7%BD%B2%E4%B8%AD%E6%A8%A1%E5%9E%8B%E6%9D%83%E9%87%8D%E7%9A%84%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95"><span class="toc-text"> 9. 嵌入式部署中模型权重的内存对齐优化方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E8%A7%A3%E9%87%8A-tensorrt-%E4%B8%AD%E7%9A%84%E5%B1%82%E8%9E%8D%E5%90%88-layer-fusion-%E4%BC%98%E5%8C%96%E5%8E%9F%E7%90%86"><span class="toc-text"> 10. 解释 TensorRT 中的层融合 (Layer Fusion) 优化原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8%E9%A2%98"><span class="toc-text"> 综合应用题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/17/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85Visual-Studio%E3%80%81CUDA/" title="离线安装Visual Studio、CUDA"><img src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/001342-17369576223624.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="离线安装Visual Studio、CUDA"/></a><div class="content"><a class="title" href="/2025/07/17/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85Visual-Studio%E3%80%81CUDA/" title="离线安装Visual Studio、CUDA">离线安装Visual Studio、CUDA</a><time datetime="2025-07-17T01:55:33.000Z" title="发表于 2025-07-17 09:55:33">2025-07-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/05/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-31/" title="每日知识点-31"><img src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="每日知识点-31"/></a><div class="content"><a class="title" href="/2025/07/05/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-31/" title="每日知识点-31">每日知识点-31</a><time datetime="2025-07-05T12:08:06.000Z" title="发表于 2025-07-05 20:08:06">2025-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/04/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-30/" title="每日知识点-30"><img src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="每日知识点-30"/></a><div class="content"><a class="title" href="/2025/07/04/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-30/" title="每日知识点-30">每日知识点-30</a><time datetime="2025-07-04T12:05:40.000Z" title="发表于 2025-07-04 20:05:40">2025-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/03/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-29/" title="每日知识点-29"><img src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="每日知识点-29"/></a><div class="content"><a class="title" href="/2025/07/03/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-29/" title="每日知识点-29">每日知识点-29</a><time datetime="2025-07-03T11:50:57.000Z" title="发表于 2025-07-03 19:50:57">2025-07-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/02/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-28/" title="每日知识点-28"><img src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/221944-17439491842122.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="每日知识点-28"/></a><div class="content"><a class="title" href="/2025/07/02/%E6%AF%8F%E6%97%A5%E7%9F%A5%E8%AF%86%E7%82%B9-28/" title="每日知识点-28">每日知识点-28</a><time datetime="2025-07-02T10:49:56.000Z" title="发表于 2025-07-02 18:49:56">2025-07-02</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:952218079@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src="https://zikcc.oss-cn-beijing.aliyuncs.com/img/20250324140542.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/zikcc" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div><div class="copyright">&copy;2025 By zikcc</div><div id="workboard"><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://github.com/zikcc/blog" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">9</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://zikcc.github.io/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">Github</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/zikcc" title="zikcc"><img class="back-menu-item-icon" src="https://zikcc.oss-cn-beijing.aliyuncs.com/blog_img/github.ico" alt="zikcc"/><span class="back-menu-item-text">zikcc</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 更多</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><span> 统计</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 0.88rem;">C<sup>38</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>40</sup></a><a href="/tags/Camke/" style="font-size: 0.88rem;">Camke<sup>1</sup></a><a href="/tags/Chaquopy/" style="font-size: 0.88rem;">Chaquopy<sup>1</sup></a><a href="/tags/Clangd/" style="font-size: 0.88rem;">Clangd<sup>1</sup></a><a href="/tags/Cuda/" style="font-size: 0.88rem;">Cuda<sup>2</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>5</sup></a><a href="/tags/FFmpeg/" style="font-size: 0.88rem;">FFmpeg<sup>2</sup></a><a href="/tags/GDB/" style="font-size: 0.88rem;">GDB<sup>1</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>1</sup></a><a href="/tags/HLS/" style="font-size: 0.88rem;">HLS<sup>2</sup></a><a href="/tags/HTTP-FLV/" style="font-size: 0.88rem;">HTTP-FLV<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>3</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>44</sup></a><a href="/tags/Mysql/" style="font-size: 0.88rem;">Mysql<sup>1</sup></a><a href="/tags/Nginx/" style="font-size: 0.88rem;">Nginx<sup>2</sup></a><a href="/tags/Nuxt3/" style="font-size: 0.88rem;">Nuxt3<sup>1</sup></a><a href="/tags/OpenCV/" style="font-size: 0.88rem;">OpenCV<sup>3</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>3</sup></a><a href="/tags/Pytorch/" style="font-size: 0.88rem;">Pytorch<sup>2</sup></a><a href="/tags/RTMP/" style="font-size: 0.88rem;">RTMP<sup>2</sup></a><a href="/tags/SpringBoot/" style="font-size: 0.88rem;">SpringBoot<sup>1</sup></a><a href="/tags/TFlite/" style="font-size: 0.88rem;">TFlite<sup>1</sup></a><a href="/tags/Visual-Studio/" style="font-size: 0.88rem;">Visual Studio<sup>1</sup></a><a href="/tags/Vscode/" style="font-size: 0.88rem;">Vscode<sup>2</sup></a><a href="/tags/Vue/" style="font-size: 0.88rem;">Vue<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">浅色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("05/18/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "";
        img.alt = "";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://zikcc-twikoo.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://zikcc-twikoo.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://zikcc-twikoo.netlify.app/.netlify/functions/twikoo',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://code.jquery.com/jquery-3.6.0.min.js"></script><script src="/custom/js/custom.js"></script><script src="https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="LOVE,PEACE" data-fontsize="20px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>